<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Status | ExpenseFlow</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f3f4f6;
            text-align: center;
        }
        .card {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            max-width: 400px;
            width: 90%;
        }
        h2 { margin-bottom: 10px; }
        p { color: #666; margin-bottom: 20px; }
        .btn {
            background: #4F46E5;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="card">
        <div id="loading">
            <h2>Verifying Payment...</h2>
            <p>Please wait while we confirm your transaction.</p>
        </div>

        <div id="success" class="hidden">
            <h2 style="color: #10B981;">Payment Successful! üéâ</h2>
            <p>You are now a Premium Member.</p>
            <a href="/html/dashboard.html" class="btn">Go to Dashboard</a>
        </div>

        <div id="failed" class="hidden">
            <h2 style="color: #EF4444;">Payment Failed ‚ùå</h2>
            <p>Something went wrong. Please try again.</p>
            <a href="/html/dashboard.html" class="btn">Back to Dashboard</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const BASE_URL = "http://localhost:5000"; // Ensure port matches server
        const token = localStorage.getItem("token");

        window.onload = async function() {
            // URL se order_id nikalo
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('order_id');

            if (!orderId) {
                showStatus('failed');
                return;
            }

            try {
                // Backend ko verify karne bolo
                const res = await axios.post(`${BASE_URL}/api/payment/verify`, 
                    { orderId: orderId },
                    { headers: { Authorization: `Bearer ${token}` } }
                );

                if (res.data.success) {
                    // LocalStorage update karo taaki UI turant change ho jaye
                    let user = JSON.parse(localStorage.getItem("user"));
                    if(user) {
                        user.isPremium = true;
                        localStorage.setItem("user", JSON.stringify(user));
                    }
                    showStatus('success');
                } else {
                    showStatus('failed');
                }

            } catch (error) {
                console.error(error);
                showStatus('failed');
            }
        };

        function showStatus(type) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById(type).classList.remove('hidden');
        }
    </script>
</body>
</html>